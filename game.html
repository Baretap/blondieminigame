<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Blondie Mini Game - Play</title>
    <link rel="stylesheet" href="styles.css">
</head>
<body>
    <h1>Blondie Mini Game</h1>
    <div id="game-container">
        <div id="game-area" class="blurred">
            <div id="info-bar">
                <p id="level">Level: 1</p>
                <p id="score">Score: 0</p>
                <p id="time">Time: 30</p>
            </div>
            <img src="blondie.png" alt="Blondie" id="blondie" class="unclickable" />
        </div>
        <div id="start-button-container">
            <button id="start-button" onclick="promptPlayerName()">Start</button>
        </div>
    </div>
    <div id="control-panel">
        <button onclick="window.location.href='wallet.html'">Wallet</button>
        <button onclick="window.location.href='tasks.html'">Tasks</button>
        <button onclick="window.location.href='leaderboard.html'">Leaderboard</button>
        <button onclick="window.location.href='index.html'">Home</button>
    </div>

    <!-- Firebase Scripts -->
    <script src="https://www.gstatic.com/firebasejs/9.22.1/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.1/firebase-database.js"></script>
    <script>
        // Your web app's Firebase configuration
        const firebaseConfig = {
            apiKey: "AIzaSyA41LovJoSleYbR1i9mhokwxMDlE0QL4Eg",
            authDomain: "blondieminigame.firebaseapp.com",
            projectId: "blondieminigame",
            storageBucket: "blondieminigame.firebasestorage.app",
            messagingSenderId: "790420999786",
            appId: "1:790420999786:web:40832a2f9368353efbc413",
            measurementId: "G-9DRTPS592J"
        };

        // Initialize Firebase
        const app = firebase.initializeApp(firebaseConfig);
        const database = firebase.database();

        let playerName = '';
        let timer;
        let score = 0;
        let time = 30;
        let level = 1;
        let pointsToNextLevel = 10;

        function promptPlayerName() {
            playerName = prompt("Enter your name:");
            if (!playerName) {
                playerName = 'Anonymous';
            }
            startGame();
        }

        function startGame() {
            document.getElementById('start-button-container').style.display = 'none';
            document.getElementById('game-area').classList.remove('blurred');
            document.getElementById('blondie').classList.remove('unclickable');
            timer = setInterval(countdown, 1000);
            moveBlondieRandomly();
        }

        function scorePoint() {
            if (!document.getElementById('blondie').classList.contains('unclickable')) {
                score++;
                document.getElementById('score').innerText = 'Score: ' + score;
                checkLevelUp();
                moveBlondieRandomly();
            }
        }

        function checkLevelUp() {
            if (score >= pointsToNextLevel * level) {
                level++;
                document.getElementById('level').innerText = 'Level: ' + level;
                if (level === 5) {
                    score += 100;
                    document.getElementById('score').innerText = 'Score: ' + score;
                    alert('Congratulations! You reached level 5 and earned 100 bonus points!');
                }
            }
        }

        function moveBlondieRandomly() {
            const gameArea = document.getElementById('game-area');
            const infoBar = document.getElementById('info-bar');
            const blondie = document.getElementById('blondie');
            const maxWidth = gameArea.clientWidth - blondie.clientWidth;
            const maxHeight = gameArea.clientHeight - blondie.clientHeight - infoBar.clientHeight;

            const randomX = Math.floor(Math.random() * maxWidth);
            const randomY = Math.floor(Math.random() * maxHeight) + infoBar.clientHeight;

            blondie.style.left = randomX + 'px';
            blondie.style.top = randomY + 'px';
        }

        function countdown() {
            time--;
            document.getElementById('time').innerText = 'Time: ' + time;
            if (time <= 0) {
                clearInterval(timer);
                alert('Time is up! Your final score is ' + score + '. You reached level ' + level + '!');
                updateTotalScore();
                submitScore();
                resetGame();
            }
        }

        function updateTotalScore() {
            let totalScore = localStorage.getItem('totalScore') || 0;
            totalScore = parseInt(totalScore) + score;
            localStorage.setItem('totalScore', totalScore);
        }

        function resetGame() {
            score = 0;
            time = 30;
            level = 1;
            document.getElementById('score').innerText = 'Score: ' + score;
            document.getElementById('time').innerText = 'Time: ' + time;
            document.getElementById('level').innerText = 'Level: ' + level;
            document.getElementById('blondie').classList.add('unclickable');
            document.getElementById('start-button-container').style.display = 'flex';
            document.getElementById('game-area').classList.add('blurred');
        }

        function submitScore() {
            const scoresRef = database.ref('scores');
            const sharedWealthRef = database.ref('sharedWealth');

            const newScoreRef = scoresRef.push();
            newScoreRef.set({
                name: playerName,
                score: score,
                timestamp: Date.now()
            });

            sharedWealthRef.once('value', function(snapshot) {
                let sharedWealth = snapshot.val() || 0;
                sharedWealth += score;
                sharedWealthRef.set(sharedWealth);
            });
        }

        document.getElementById('blondie').addEventListener('click', scorePoint);
    </script>
</body>
</html>
